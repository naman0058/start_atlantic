<%- include ('./adminheader.ejs') %>

<style>
    body {
      font-family: "Open Sans", sans-serif;
      background: #e4e4e4;
      margin: 20px 0;
    }
    body .h1 {
      font-size: 2em;
    }
    body .h2 {
      font-size: 1.5em;
    }
    body .h3 {
      font-size: 1.17em;
    }
    body .h4 {
      font-size: 1em;
    }
    .editor-toolbar {
      background: #fff;
      border: 1px solid #cecece;
      margin: 0;
      padding: 0;
    }
    .editor-toolbar a {
      display: inline-block;
      padding: 8px 12px;
      color: #000;
    }
    .editor-toolbar a:hover {
      background: #e4e4e4;
    }
    .editor-toolbar .active {
      background: #e4e4e4;
    }
    .editor-toolbar .dropdown {
      display: inline-block;
    }
    .editor-toolbar .dropdown .btn-default {
      border: none;
    }
    .editor-toolbar .dropdown .btn-default:focus,
    .editor-toolbar .dropdown .btn-default:hover {
      background: none;
    }
    .editor-toolbar .dropdown a {
      margin: 0;
    }
    #editor {
      resize: vertical;
      overflow: auto;
      line-height: 1.5;
      background: #fff;
      border: 1px solid #cecece;
      border-top: none;
      min-height: 150px;
      box-shadow: none;
      padding: 8px 16px;
      margin: 0 0 10px 0;
      font-size: 14px;
    }
    #editor:focus {
      outline: none;
    }
    #editor1 {
      resize: vertical;
      overflow: auto;
      line-height: 1.5;
      background: #fff;
      border: 1px solid #cecece;
      border-top: none;
      min-height: 150px;
      box-shadow: none;
      padding: 8px 16px;
      margin: 0 0 10px 0;
      font-size: 14px;
    }
    #editor1:focus {
      outline: none;
    }
    unselectable {
      -webkit-user-select: none;
      -moz-user-select: -moz-none;
      -ms-user-select: none;
    }
    </style>
    
<!--InsertDiv-->


  <div class="container-fluid mt--7">
      <div id="insertdiv">
    <div class="row">
      <div class="col-xl-12 order-xl-1">
        <div class="card bg-secondary shadow">
            <div class="card-header bg-white border-0">
                <div class="row align-items-center">
                  <div class="col-8">
                    <h3 class="mb-0">Add Immigration Content</h3>
                  </div>
                  <div class="col-4 text-right">
                    <button type="button" id="show" class="btn btn-sm btn-primary">Show</button>
                  </div>
                </div>
              </div>
              
          <div class="card-body">
            <form action="/immigration_content/insert" method="post" enctype="multipart/form-data" class="uploadImage">
              <div class="pl-lg-4">
         

                <div class="row">
                  <div class="col-lg-6">
                    <div class="form-group">
                      <label class="form-control-label" for="input-username">Country Name</label>
                      <select name="countryid" id="leagueid" class="form-control form-control-alternative">
                       </select>
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="form-group">
                      <label class="form-control-label" for="input-email">State Name</label>
                      <select name="stateid" id="stateid" class="form-control form-control-alternative">
                    </select>
                    </div>
                    </div>
                 
                </div>


                


                      
      <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12">
      
            <div class="container">
              <label>Content</label>
             
              <div class="editor-toolbar">
                <div class="dropdown">
                  <button class="btn  dropdown-toggle" type="button" id="headingMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                    Heading
                    <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu" aria-labelledby="headingMenu">
                    <li><a href="javascript:void(0)" onclick="runCommand(this, 'formatBlock', 'h1')" class="h1">Heading 1</a></li>
                    <li><a href="javascript:void(0)" onclick="runCommand(this, 'formatBlock', 'h2')" class="h2">Heading 2</a></li>
                    <li><a href="javascript:void(0)" onclick="runCommand(this, 'formatBlock', 'h3')" class="h3">Heading 3</a></li>          
                    <li><a href="javascript:void(0)" onclick="runCommand(this, 'formatBlock', 'h4')" class="h4">Heading 4</a></li>
                  </ul>
                </div>
                
                
                <a href="javascript:void(0)" role="button" class="toolbar-btn unselectable" onclick="runCommand(this, 'bold', null)" unselectable="on"><i class="fa fa-bold"></i></a>
                <a href="javascript:void(0)" role="button" class="toolbar-btn" onclick="runCommand(this, 'italic', null)"><i class="fa fa-italic"></i></a>
                <a href="javascript:void(0)" role="button" onclick="runCommand(this, 'underline', null)"><i class="fa fa-underline"></i></a> 
                <a href="javascript:void(0)" role="button" onclick="runCommand(this, 'indent', null)"><i class="fa fa-indent"></i></a> 
                <a href="javascript:void(0)" role="button" onclick="runCommand(this, 'insertUnorderedList', null)"><i class="fa fa-list-ul"></i></a> 
                <a href="javascript:void(0)" role="button" onclick="runCommand(this, 'insertOrderedList', null)"><i class="fa fa-list-ol"></i></a>
                <a href="javascript:void(0)" role="button" onclick="runCommand(this, 'createLink', null)"><i class="fa fa-link"></i></a>
                <a href="javascript:void(0)" role="button" onclick="runCommand(this, 'unlink', null)"><i class="fa fa-unlink"></i></a>
                <a href="javascript:void(0)" role="button" onclick="runCommand(this, 'redo', null)"><i class="fa fa-repeat"></i></a>
                <a href="javascript:void(0)" role="button" onclick="runCommand(this, 'undo', null)"><i class="fa fa-undo"></i></a>         
              </div>
              
              <div id="editor" class="editor"  contenteditable="true"></div>
              <!-- <textarea  id="messageText" type="hidden" class="pdescription" name = 'description' ></textarea> -->
              
              <!-- <div class="row">
                <div class="col-sm-2">
                  <button id="submit" class="btn btn-default btn-block" type="submit">Submit</button>
                </div>
              </div> -->
            </div>
            
           </div>
           </div> 

            


                   
                    
                    <div class="row">
                        <div class="col-lg-12">
                          <div class="form-group">
                            <label class="form-control-label" for="input-username">Image</label>
                            <input type="file" id="input-email" name="logo" class="form-control form-control-alternative">

                          </div>
                        </div>
                  
                      </div>

        
          


                <div class="row">
                  <div class="col-md-12">
                    <div class="form-group">
                      <button type="submit" class="btn btn-info">Save</button>
                    </div>
                  </div>
                </div>
            </form>
          </div>
        </div>
      </div>
    </div>
 </div>
</div>
</div>

<!--End InsertDiv-->

<div id="result"></div>
<!--EditDiv-->


    <div id="editdiv">
  <div class="row">
    <div class="col-xl-12 order-xl-1">
      <div class="card bg-secondary shadow">
          <div class="card-header bg-white border-0">
              <div class="row align-items-center">
                <div class="col-8">
                  <h3 class="mb-0">Edit Immigration Content</h3>
                </div>
                <div class="col-4 text-right">
                  <button type="button" id="back1" class="btn btn-sm btn-primary">Back</button>
                </div>
              </div>
            </div>
            
        <div class="card-body">
            <div class="pl-lg-4">
         


             

              <div class="row">
                <div class="col-lg-6">
                  <div class="form-group">
                    <label class="form-control-label" for="input-username">Country Name</label>
                    <select name="countryid" id="pleagueid" class="form-control form-control-alternative">
                     </select>
                  </div>
                </div>
                <div class="col-lg-6">
                  <div class="form-group">
                    <label class="form-control-label" for="input-email">State Name</label>
                    <select name="stateid" id="pstateid" class="form-control form-control-alternative">
                  </select>
                  </div>
                  </div>
                
              </div>



<input type="hidden" id="pid">


              

                    
    <div class="row">
      <div class="col-lg-12 col-md-12 col-sm-12">
    
          <div class="container">
            <label>Content</label>
           
            <div class="editor-toolbar">
              <div class="dropdown">
                <button class="btn  dropdown-toggle" type="button" id="headingMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                  Heading
                  <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" aria-labelledby="headingMenu">
                  <li><a href="javascript:void(0)" onclick="runCommand(this, 'formatBlock', 'h1')" class="h1">Heading 1</a></li>
                  <li><a href="javascript:void(0)" onclick="runCommand(this, 'formatBlock', 'h2')" class="h2">Heading 2</a></li>
                  <li><a href="javascript:void(0)" onclick="runCommand(this, 'formatBlock', 'h3')" class="h3">Heading 3</a></li>          
                  <li><a href="javascript:void(0)" onclick="runCommand(this, 'formatBlock', 'h4')" class="h4">Heading 4</a></li>
                </ul>
              </div>
              
              
              <a href="javascript:void(0)" role="button" class="toolbar-btn unselectable" onclick="runCommand(this, 'bold', null)" unselectable="on"><i class="fa fa-bold"></i></a>
              <a href="javascript:void(0)" role="button" class="toolbar-btn" onclick="runCommand(this, 'italic', null)"><i class="fa fa-italic"></i></a>
              <a href="javascript:void(0)" role="button" onclick="runCommand(this, 'underline', null)"><i class="fa fa-underline"></i></a> 
              <a href="javascript:void(0)" role="button" onclick="runCommand(this, 'indent', null)"><i class="fa fa-indent"></i></a> 
              <a href="javascript:void(0)" role="button" onclick="runCommand(this, 'insertUnorderedList', null)"><i class="fa fa-list-ul"></i></a> 
              <a href="javascript:void(0)" role="button" onclick="runCommand(this, 'insertOrderedList', null)"><i class="fa fa-list-ol"></i></a>
              <a href="javascript:void(0)" role="button" onclick="runCommand(this, 'createLink', null)"><i class="fa fa-link"></i></a>
              <a href="javascript:void(0)" role="button" onclick="runCommand(this, 'unlink', null)"><i class="fa fa-unlink"></i></a>
              <a href="javascript:void(0)" role="button" onclick="runCommand(this, 'redo', null)"><i class="fa fa-repeat"></i></a>
              <a href="javascript:void(0)" role="button" onclick="runCommand(this, 'undo', null)"><i class="fa fa-undo"></i></a>         
            </div>
            
            <div id="editor" class="peditor"  contenteditable="true"></div>
            <!-- <textarea  id="messageText" type="hidden" class="pdescription" name = 'description' ></textarea> -->
            
            <!-- <div class="row">
              <div class="col-sm-2">
                <button id="submit" class="btn btn-default btn-block" type="submit">Submit</button>
              </div>
            </div> -->
          </div>
          
         </div>
         </div> 

          


          

          
              <div class="row">
                <div class="col-md-12">
                  <div class="form-group">
                    <button type="submit" id="update" class="btn btn-info">Update Data</button>
                  </div>
                </div>
              </div>
        </div>
      </div>
    </div>
  </div>
</div>
    </div>


<!--Ends EditDiv-->

<!--UpdateImageDiv Start-->
<div id="updateimagediv">
    <div class="row">
      <div class="col-xl-12 order-xl-1">
        <div class="card bg-secondary shadow">
            <div class="card-header bg-white border-0">
                <div class="row align-items-center">
                  <div class="col-8">
                    <h3 class="mb-0">Update Visa Logo</h3>
                  </div>
                  <div class="col-4 text-right">
                    <button type="button" id="back2" class="btn btn-sm btn-primary">Back</button>
                  </div>
                </div>
              </div>
              
          <div class="card-body">
            <form action="/immigration_content/update_image" method="post" enctype="multipart/form-data">
              <div class="pl-lg-4">
                <div class="row">
                  <div class="col-lg-6">
                    <div class="form-group">
                      <label class="form-control-label" for="input-username"> ID</label>
                      <input type="text" name="id" id="peid"  class="form-control form-control-alternative"
                        placeholder="ID" readonly>
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="form-group">
                      <label class="form-control-label" for="input-email">Image</label>
                      <input type="file" name="logo"  class="form-control form-control-alternative">
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-12">
                    <div class="form-group">
                      <button type="submit" id="update" class="btn btn-info">Update Image</button>
                    </div>
                  </div>
                </div>
                </form>
          </div>
        </div>
      </div>
    </div>
  </div>
      </div>
  
  
      <!-- Footer -->
      <footer class="footer">
        <div class="row align-items-center justify-content-xl-between">
          <div class="col-xl-6">
            
          </div>
        
        </div>
      </footer>
    </div>
  </div>
  <!-- Argon Scripts -->
  <!-- Core -->
  <script src="/admin/assets/vendor/jquery/dist/jquery.min.js"></script>
  <script src="/admin/assets/vendor/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Argon JS -->
  <script src="/admin/assets/js/argon.js?v=1.0.0"></script>
  
  <script type="text/javascript" src="/javascripts/immigration_content.js"></script>



  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.form/3.51/jquery.form.min.js"></script>
  <script>
  
    $('.uploadImage').submit(function (e) {
      e.preventDefault();
      let content = $("#editor").html().trim();
    
      // var title = $('#title').val(); 
  
      $(this).ajaxSubmit({
         data: {content: content},
        contentType: 'application/json',
        success: function (response) {
          console.log(response)
          if(response.status=='300' || response.status==300) alert(response.description)
          else {
         alert('successfully')
          window.location.reload()
          }
        }
      });
      return false;
    });
  
  
  
  </script>



<script>
  // Move caret back to 
function placeCaretAtEnd(el) {
  el.focus();
  if (typeof window.getSelection != "undefined" && typeof document.createRange != "undefined") {
    var range = document.createRange();
    range.selectNodeContents(el);
    range.collapse(false);
    var sel = window.getSelection();
    sel.removeAllRanges();
    sel.addRange(range);
  } else if (typeof document.body.createTextRange != "undefined") {
    var textRange = document.body.createTextRange();
    textRange.moveToElementText(el);
    textRange.collapse(false);
    textRange.select();
  }
}
// Clean HTML tags using sanitize-html
function cleanHtml() {  
  let value = $("#editor").html();
  let clean = sanitizeHtml(value, {
    allowedTags: ['div', 'blockquote', 'b', 'strong', 'i', 'em', 'ul', 'ol', 'li'],
    allowedAttributes: {
      'blockquote': ['style']
    }
  });
  let cleanValue = clean.trim();  
  setContent();
}
// Paste from MS Word    *CREDIT: https://gist.github.com/sbrin/6801034
(function($) {
    $.fn.msword_html_filter = function(options) {
      let settings = $.extend( {}, options);
      function word_filter(editor){
        let content = editor.html();
        // Word comments like conditional comments etc
        content = content.replace(/<!--[\s\S]+?-->/gi, '');
        // Remove comments, scripts (e.g., msoShowComment), XML tag, VML content,
        // MS Office namespaced tags, and a few other tags
        content = content.replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi, '');
        // Convert <s> into <strike> for line-though
        content = content.replace(/<(\/?)s>/gi, "<$1strike>");
        // Replace nbsp entites to char since it's easier to handle
        //content = content.replace(/&nbsp;/gi, "\u00a0");
        content = content.replace(/&nbsp;/gi, ' ');
        // Convert <span style="mso-spacerun:yes">___</span> to string of alternating
        // breaking/non-breaking spaces of same length
        content = content.replace(/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi, function(str, spaces) {
          return (spaces.length > 0) ? spaces.replace(/./, " ").slice(Math.floor(spaces.length/2)).split("").join("\u00a0") : '';
        });
        editor.html(content);
        // Parse out list indent level for lists
        $('p', editor).each(function(){
          let str = $(this).attr('style');
          let matches = /mso-list:\w+ \w+([0-9]+)/.exec(str);
          if (matches) {
            $(this).data('_listLevel',  parseInt(matches[1], 10));
          }
        });
        // Parse Lists
        let last_level=0;
        let pnt = null;
        $('p', editor).each(function(){
            let cur_level = $(this).data('_listLevel');
            if(cur_level != undefined){
                let txt = $(this).text();
                let list_tag = '<ul></ul>';
                if (/^\s*\w+\./.test(txt)) {
                    let matches = /([0-9])\./.exec(txt);
                    if (matches) {
                        let start = parseInt(matches[1], 10);
                        list_tag = start>1 ? '<ol start="' + start + '"></ol>' : '<ol></ol>';
                    }else{
                        list_tag = '<ol></ol>';
                    }
                }
                if(cur_level>last_level){
                  if(last_level==0){
                    $(this).before(list_tag);
                    pnt = $(this).prev();
                  }else{
                    pnt = $(list_tag).appendTo(pnt);
                  }
                }
                if(cur_level<last_level){
                  for(let i=0; i<last_level-cur_level; i++){
                    pnt = pnt.parent();
                  }
                }
                $('span:first', this).remove();
                pnt.append('<li>' + $(this).html().replace(/\d+\./g, '') + '</li>')
                $('b:empty').remove();
                $(this).remove();
                last_level = cur_level;
            }else{
                last_level = 0;
            }
        })
        $('[style]', editor).removeAttr('style');
        $('[align]', editor).removeAttr('align');
        $('span', editor).replaceWith(function() {return $(this).contents();});
        $('span:empty', editor).remove();
        $("[class^='Mso']", editor).removeAttr('class');
        $('p:empty', editor).remove();
      }
      return this.each(function() {
        let self = this;
        $(self).on('keyup paste', function(){
          
          setTimeout(function() {
             let content = $(self).html();
            (/class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i.test( content )) ? word_filter( $(self) ) : cleanHtml();
          }, 400);           
        });
      });
    };
})( jQuery )
$(function(){  
  $('#editor').msword_html_filter(); 
})
function setContent() {
  let value = $(this).html();
  
  let el = $("#editor").get(0);
  placeCaretAtEnd(el);
}
//### EVENTS/ACTIONS ###//
//execCommand(aCommandName, aShowDefaultUI, aValueArgument)
function runCommand(el, commandName, arg) {  
  if (commandName === "createLink") {
    let argument = prompt("Insert link:");
    document.execCommand(commandName, false, argument);
  }else {    
    document.execCommand(commandName, false, arg);
  }  
  $("#editor").focus();
  return false;
}
// Capture wysiwyg val and assign to textarea val
// $("#editor").keyup(function() {
//   let value = $(this).html();
//   $("#messageText").val(value);  
// });
// Show submitted data
$('#submit').click(function(e) {
  e.preventDefault();
  let content = $("#editor").html().trim();
  alert("VALUE SUBMITTED: \n" + content);  
});
</script>




</body>

</html>